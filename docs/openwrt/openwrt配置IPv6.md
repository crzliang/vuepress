---
title: openwrt配置IPv6
tags:
  - openwrt
  - IPv6
permalink: /archives/25815/
createTime: 2025-03-04 17:41:33
---
## 前情

在上周五（2.27）我把开发机接上了教育网的网段（社团这边可以接入，我们就用交换机做了vlan实现了教育网进主路由和直连社团的服务器）

我神奇的发现了接入教育网的网卡分到了IPv6的地址，于是乎就把主路由上的IPv6也打开了（因为之前一直没有分配IPv6的地址，所以就把wan口上获取IPv6的功能给关掉了）

## wan口配置

新建一个接口，命名为**wan6**，协议选择**DHCPv6客户端**，分别分配到了**一个/128**和**一个/64**，以下是这些前缀的解释

| 前缀   | 用途                                                         |
| ------ | ------------------------------------------------------------ |
| `/128` | 单个设备地址（相当于 IPv4 的单个 IP）/用于 loopback（回环地址） |
| `/64`  | 单个子网（最常见）                                           |
| `/48`  | ISP 分配给企业或组织的网络前缀，通常包含多个 `/64` 子网      |
| `/32`  | ISP 分配给大型机构或服务提供商                               |

![image-20250304175124764](https://img.crzliang.cn/img/202503041819676.png)

那么也就是说这个时候是可以给我们内网的所有机器都分配一个教育网的IPv6地址，但是经过测试是整个学校的内网都有分配IPv6，且没有做隔离，也就是校内整个大内网都可以互联互通。因为我们内网的服务器基本都是弱口令（因为不想记密码），出于安全考虑，我们内网还是使用内网保留地址，我们选择了`fdd2:34:56::1/64`

| 地址类型                | 地址范围                      | 作用                             |
| ----------------------- | ----------------------------- | -------------------------------- |
| **唯一本地地址（ULA）** | `fc00::/7`（通常 `fd00::/8`） | 内网私有地址，类似 IPv4 私有地址 |
| **链路本地地址**        | `fe80::/10`                   | 仅限同一链路，自动分配           |
| **回环地址**            | `::1/128`                     | 本机回环（localhost）            |
| **多播地址**            | `ff00::/8`                    | 组播通信，替代广播               |

![image-20250304180552645](https://img.crzliang.cn/img/202503041805554.png)

## 配置IPv6 ULA 前缀

默认情况下，openwrt的IPv6ULA前缀是随机生成的，如下图所示：

![image-20250304182850057](https://img.crzliang.cn/img/202503041848320.png)

想要设置成个性一点的就是在**网络->接口->全局网络选项**中把ULA前缀修改成自己要想的即可，这是针对需要设置成**服务器模式**的情况，如果是要让内网所有机器都有公网IPv6地址的，这一步可以忽略

## lan配置

**接口->lan->高级设置**，把委托IPv6前缀勾上，IPv6分配长度设置成64，这样内网的机器才能分配到IP，后缀默认设置

![image-20250304183121659](https://img.crzliang.cn/img/202503041848377.png)

然后选择**DHCP服务器**->**IPv6设置**（把RA服务和DHCPv6服务都设置成服务器模式）

![image-20250304180643492](https://img.crzliang.cn/img/202503041808909.png)

在**IPv6 RA设置**中，主要是把默认路由器改成**强制的**即可，保存并应用后内网设备开启IPv6后即可获得IPv6的地址

![image-20250304180748772](https://img.crzliang.cn/img/202503041819125.png)

内网设备获取到正确的IPv6地址

![image-20250304181032736](https://img.crzliang.cn/img/202503041819318.png)

![image-20250304181116079](https://img.crzliang.cn/img/202503041819829.png)

## 有什么用？

使用过香港vps的小伙伴都可能会遇到，买到的线路不是很理想，IPv4一般都会绕道到美国/日本，才能到香港

但是，有了IPv6之后就不一样了，教育网的IPv6是有直连香港的线路，这对于降低延迟是非常有帮助的
