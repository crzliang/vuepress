---
title: 旁路网关的探索之路
tags:
  - 旁路网关
  - openwrt
  - singbox
  - v2ray
permalink: /archives/33787/
createTime: 2024-11-21 21:45:42
---

# 前言

自从chatgpt出世以来，对于ai的依赖是越来越大，但是对于国内的各类ai并不是很感冒，还是比较喜欢用国外的ai，当然也还有一个原因，因为使用教育邮箱可以白嫖copilot，这对于学计算机的学生来说实在是太香了(PS: 还是不建议太过于依赖ai，不然代码都不懂怎么码了)

还有就是baidu有些时候真的是太难用了，搜个东西排前面的全都是打广告的，要想找到想要的还得往下翻

鉴于上诉原因，我对于科学上网就有了一定的需求（但是不大）；正常情况下，大家一般都是使用的clash、v2rayn等客户端软件在自己的电脑或者手机上运行，以达到科学上网的目的，但我觉得这样不优雅，再加上折腾过一段时间的openwrt，于是就开始去找在op上实现科学上网的方法，有很多方案，在这就不列举了。

## 需求

因为我买了一台hk的vps，就自己搭建了一条链路使用，但是这台机器并不能解锁chatgpt，所以就需要用到分流，当访问chatgpt的时候使用其他的链路

在做这件事的过程中我用过了：v2raya和homeproxy这两个，目前是使用homeproxy，v2raya方案已经舍弃

# 探索之路

## v2

v2raya这个方案是最开始用的，用这个还是因为在实习过程中接触到的，感觉还是不错的，可以自己配置路由、dns(包括doh等等)，所以等实习结束后回到学校就部署了这套方案，然后也摸索出了使用自定义路由的分流方案，但是在实际的运行过程中，我遇到了：

- 手机在使用我的旁路网关的时候，微信发不出视频和图片，再添加了微信的api规则后，就能正常使用了
- 也是手机在使用我的旁路网关的时候，微信小程序在打开的时候会出现页面全白，刷新不出内容

当时就是遇到了以上两种问题，虽然无伤大雅，但是这就给我一种感觉，保不齐哪天访问国内的某些资源的时候，他又给我来那么一下，就挺难受的，还得去排查

上面提到的自定义路由规则中，我是先写了国内的自连规则，然后就是国外的规则，其中把chatgpt的规则写在了这部分的第一条，最后是默认规则，走自连

因为已经删了，也没有做保留，这就放不出配置文件了

## dae

这个不是我部署的，是社团的学弟部署的，我也用过了一段时间，也遇到了一点问题，就是dns得使用外部的，不能使用自己的网关或者主路由的IP，这也不算什么大问题，也能接受。但是后面我也遇到了在使用这个网关的时候，偶尔刷不出小程序的内容

还有就是我也不想浪费了我的vps，所以又就自己搭了自己的网关

## homeproxy

这个方案其实我也早有听过，但是没用过，前几天我又在找分流方法的时候就看到了homeproxy也是支持自定义路由进行分流的，于是就部署起来了，软路由系统我没用原版的op，而是用了国内大佬强化过的ImmortalWrt，这个固件只需要update软件包后即可直接安装homeproxy，非常方便

具体配置教程：[使用Homeproxy科学上网分流目标网站](https://www.bandwh.com/net/1621.html)

homeproxy自带绕过中国流量和默认出战可以设置成自连，这对于主国内，国外为辅的就挺好的
